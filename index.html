<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statement of No Loss</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 10px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        /* Language Toggle Styles */
        .language-toggle {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 5px;
            background: rgba(255,255,255,0.2);
            padding: 5px;
            border-radius: 8px;
            z-index: 10;
        }
        
        .lang-btn {
            padding: 5px 12px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .lang-btn.active {
            background: white;
            color: #2a5298;
        }
        
        .lang-btn:hover:not(.active) {
            background: rgba(255,255,255,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .agency-logo {
            max-width: 200px;
            max-height: 80px;
            margin-bottom: 15px;
            display: none;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 15px;
            font-weight: 600;
            padding-top: 20px;
        }
        
        .header h2 {
            font-size: 20px;
            font-weight: 400;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .agent-info {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .agent-info p {
            font-size: 13px;
            margin: 3px 0;
        }
        
        .form-container {
            padding: 30px 20px;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .required-star {
            color: #e74c3c;
            margin-left: 3px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .date-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            font-weight: 500;
            cursor: pointer;
        }
        
        .signature-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .signature-pad {
            border: 2px dashed #ddd;
            border-radius: 10px;
            min-height: 200px;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        #signatureCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }
        
        .signature-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn-clear {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-clear:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102,126,234,0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Loading Spinner */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Success/Error Messages */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Success Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .success-icon::before {
            content: '✓';
            color: white;
            font-size: 48px;
            font-weight: bold;
        }
        
        .modal-content h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .confirmation-number {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
        }
        
        .modal-close {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            transform: translateY(-2px);
        }
        
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        
        .footer-agency {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .footer-contact {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .powered-by {
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #999;
            margin-top: 15px;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 600px) {
            .header h1 { font-size: 24px; }
            .header h2 { font-size: 18px; }
            .form-container { padding: 20px 15px; }
            .date-range { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('en')">English</button>
                <button class="lang-btn" onclick="setLanguage('es')">Español</button>
            </div>
            <!-- Agency Logo (if provided via URL) -->
            <img id="agencyLogo" class="agency-logo" alt="Agency Logo">
            <!-- Dynamic Agency Name -->
            <h1 id="agencyName">Statement of No Loss</h1>
            <h2 data-translate="formTitle">Policy Reinstatement Form</h2>
            <p data-translate="formDescription">Electronic Signature Authorization</p>
            <!-- Agent Contact Info (if provided) -->
            <div class="agent-info" id="agentInfo">
                <p id="agentContactTitle"><strong>Your Agent:</strong></p>
                <p id="agentName"></p>
                <p id="agentEmail"></p>
                <p id="agentPhone"></p>
            </div>
        </div>
        
        <form id="noLossForm" class="form-container">
            <!-- Hidden fields for agency/agent info -->
            <input type="hidden" id="hiddenAgencyName" name="agencyName">
            <input type="hidden" id="hiddenAgencyEmail" name="agencyEmail">
            <input type="hidden" id="hiddenAgencyPhone" name="agencyPhone">
            <input type="hidden" id="hiddenAgentName" name="agentName">
            <input type="hidden" id="hiddenAgentEmail" name="agentEmail">
            <input type="hidden" id="hiddenAgentPhone" name="agentPhone">
            
            <!-- Policyholder Information -->
            <div class="form-section">
                <h3 class="section-title" data-translate="policyholderInfo">Policyholder Information</h3>
                
                <div class="form-group">
                    <label for="insuredName">
                        <span data-translate="insuredName">Insured Name</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="text" id="insuredName" name="insuredName" required>
                </div>
                
                <div class="form-group">
                    <label for="policyNumber">
                        <span data-translate="policyNumber">Policy Number</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="text" id="policyNumber" name="policyNumber" required>
                </div>
                
                <div class="form-group">
                    <label for="propertyAddress">
                        <span data-translate="propertyAddress">Property Address</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="text" id="propertyAddress" name="propertyAddress" required>
                </div>
                
                <div class="form-group">
                    <label for="city">
                        <span data-translate="city">City</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="date-range">
                    <div class="form-group">
                        <label for="state">
                            <span data-translate="state">State</span>
                            <span class="required-star">*</span>
                        </label>
                        <select id="state" name="state" required>
                            <option value="">Select State</option>
                            <option value="NC">North Carolina</option>
                            <option value="SC">South Carolina</option>
                            <option value="VA">Virginia</option>
                            <option value="GA">Georgia</option>
                            <option value="TN">Tennessee</option>
                            <option value="FL">Florida</option>
                            <option value="AL">Alabama</option>
                            <option value="MS">Mississippi</option>
                            <option value="LA">Louisiana</option>
                            <option value="TX">Texas</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="zipCode">
                            <span data-translate="zipCode">ZIP Code</span>
                            <span class="required-star">*</span>
                        </label>
                        <input type="text" id="zipCode" name="zipCode" pattern="[0-9]{5}" maxlength="5" required>
                    </div>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div class="form-section">
                <h3 class="section-title" data-translate="contactInfo">Contact Information</h3>
                
                <div class="form-group">
                    <label for="email">
                        <span data-translate="email">Email Address</span>
                    </label>
                    <input type="email" id="email" name="email">
                </div>
                
                <div class="form-group">
                    <label for="phone">
                        <span data-translate="phone">Phone Number</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
            </div>
            
            <!-- Coverage Period -->
            <div class="form-section">
                <h3 class="section-title" data-translate="coveragePeriod">Coverage Lapse Period</h3>
                
                <div class="date-range">
                    <div class="form-group">
                        <label for="lapseStartDate">
                            <span data-translate="lapseStartDate">Lapse Start Date</span>
                            <span class="required-star">*</span>
                        </label>
                        <input type="date" id="lapseStartDate" name="lapseStartDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lapseEndDate">
                            <span data-translate="lapseEndDate">Reinstatement Date</span>
                            <span class="required-star">*</span>
                        </label>
                        <input type="date" id="lapseEndDate" name="lapseEndDate" required>
                    </div>
                </div>
            </div>
            
            <!-- Statement of No Loss -->
            <div class="form-section">
                <h3 class="section-title" data-translate="statementSection">Statement of No Loss</h3>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="noLossConfirmation" name="noLossConfirmation" required>
                    <label for="noLossConfirmation" data-translate="noLossStatement">
                        I hereby certify that NO LOSS, damage, or claim has occurred to the above-described property during the period of lapse in coverage.
                    </label>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="understandReinstatement" name="understandReinstatement" required>
                    <label for="understandReinstatement" data-translate="understandStatement">
                        I understand that this statement is required for reinstatement of my policy and that any false statement may void coverage.
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="additionalComments">
                        <span data-translate="additionalComments">Additional Comments (Optional)</span>
                    </label>
                    <textarea id="additionalComments" name="additionalComments" rows="3"></textarea>
                </div>
            </div>
            
            <!-- Signature Section -->
            <div class="form-section">
                <h3 class="section-title" data-translate="signatureSection">Electronic Signature</h3>
                
                <div class="signature-section">
                    <p data-translate="signatureInstructions" style="margin-bottom: 15px; color: #666;">
                        Please sign below using your mouse or finger
                    </p>
                    <div class="signature-pad" id="signaturePad">
                        <canvas id="signatureCanvas"></canvas>
                    </div>
                    <div class="signature-controls">
                        <button type="button" class="btn-clear" onclick="clearSignature()" data-translate="clearSignature">Clear Signature</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="signatureDate">
                        <span data-translate="signatureDate">Date</span>
                        <span class="required-star">*</span>
                    </label>
                    <input type="date" id="signatureDate" name="signatureDate" required>
                </div>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="submit-btn" id="submitBtn">
                <span id="btnText" data-translate="submitButton">Submit Statement of No Loss</span>
                <div class="spinner" id="spinner"></div>
            </button>
            
            <!-- Messages -->
            <div id="successMessage" class="message success"></div>
            <div id="errorMessage" class="message error"></div>
        </form>
        
        <div class="footer">
            <!-- Dynamic Agency Footer -->
            <div id="agencyFooter">
                <div class="footer-agency" id="footerAgencyName"></div>
                <div class="footer-contact" id="footerAgencyContact"></div>
            </div>
            <div class="powered-by">
                Powered by NoLossForm.com
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="success-icon"></div>
            <h3 data-translate="successTitle">Statement Submitted!</h3>
            <p data-translate="successMessage">Your Statement of No Loss has been successfully submitted.</p>
            <div class="confirmation-number" id="confirmationNumber"></div>
            <p data-translate="successNote" style="color: #666; font-size: 14px; margin: 15px 0;">
                A confirmation email has been sent if an email address was provided.
            </p>
            <button class="modal-close" onclick="closeModal()" data-translate="closeButton">Close</button>
        </div>
    </div>
    
    <script>
        // Your Script URL from Google Apps Script deployment
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxP5rFSrbrDJ_3bFwi0xyBy054h5WkYBP89o54k5sEX7fk_8u0a74SbdHG0s3s32RDR/exec';
        
        // Translation dictionary
        const translations = {
            en: {
                formTitle: "Policy Reinstatement Form",
                formDescription: "Electronic Signature Authorization",
                policyholderInfo: "Policyholder Information",
                insuredName: "Insured Name",
                policyNumber: "Policy Number",
                propertyAddress: "Property Address",
                city: "City",
                state: "State",
                zipCode: "ZIP Code",
                contactInfo: "Contact Information",
                email: "Email Address",
                phone: "Phone Number",
                coveragePeriod: "Coverage Lapse Period",
                lapseStartDate: "Lapse Start Date",
                lapseEndDate: "Reinstatement Date",
                statementSection: "Statement of No Loss",
                noLossStatement: "I hereby certify that NO LOSS, damage, or claim has occurred to the above-described property during the period of lapse in coverage.",
                understandStatement: "I understand that this statement is required for reinstatement of my policy and that any false statement may void coverage.",
                additionalComments: "Additional Comments (Optional)",
                signatureSection: "Electronic Signature",
                signatureInstructions: "Please sign below using your mouse or finger",
                clearSignature: "Clear Signature",
                signatureDate: "Date",
                submitButton: "Submit Statement of No Loss",
                successTitle: "Statement Submitted!",
                successMessage: "Your Statement of No Loss has been successfully submitted.",
                successNote: "A confirmation email has been sent if an email address was provided.",
                closeButton: "Close"
            },
            es: {
                formTitle: "Formulario de Restablecimiento de Póliza",
                formDescription: "Autorización de Firma Electrónica",
                policyholderInfo: "Información del Asegurado",
                insuredName: "Nombre del Asegurado",
                policyNumber: "Número de Póliza",
                propertyAddress: "Dirección de la Propiedad",
                city: "Ciudad",
                state: "Estado",
                zipCode: "Código Postal",
                contactInfo: "Información de Contacto",
                email: "Correo Electrónico",
                phone: "Número de Teléfono",
                coveragePeriod: "Período de Lapso de Cobertura",
                lapseStartDate: "Fecha de Inicio del Lapso",
                lapseEndDate: "Fecha de Restablecimiento",
                statementSection: "Declaración de No Pérdida",
                noLossStatement: "Por la presente certifico que NO ha ocurrido NINGUNA PÉRDIDA, daño o reclamo a la propiedad descrita durante el período de lapso en la cobertura.",
                understandStatement: "Entiendo que esta declaración es requerida para el restablecimiento de mi póliza y que cualquier declaración falsa puede anular la cobertura.",
                additionalComments: "Comentarios Adicionales (Opcional)",
                signatureSection: "Firma Electrónica",
                signatureInstructions: "Por favor firme abajo usando su mouse o dedo",
                clearSignature: "Borrar Firma",
                signatureDate: "Fecha",
                submitButton: "Enviar Declaración de No Pérdida",
                successTitle: "¡Declaración Enviada!",
                successMessage: "Su Declaración de No Pérdida ha sido enviada exitosamente.",
                successNote: "Se ha enviado un correo de confirmación si se proporcionó una dirección de correo.",
                closeButton: "Cerrar"
            }
        };
        
        let currentLanguage = 'en';
        let signaturePad = null;
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Extract all agency and agent information from URL
            const agencyName = urlParams.get('agencyName');
            const agencyEmail = urlParams.get('agencyEmail');
            const agencyPhone = urlParams.get('agencyPhone');
            const agentName = urlParams.get('agentName');
            const agentEmail = urlParams.get('agentEmail');
            const agentPhone = urlParams.get('agentPhone');
            const agencyLogo = urlParams.get('agencyLogo');
            
            // Update header with agency information
            if (agencyName) {
                // Display agency name in header
                document.getElementById('agencyName').textContent = decodeURIComponent(agencyName);
                document.getElementById('hiddenAgencyName').value = decodeURIComponent(agencyName);
                
                // Display agency logo if provided
                if (agencyLogo) {
                    const logoElement = document.getElementById('agencyLogo');
                    logoElement.src = decodeURIComponent(agencyLogo);
                    logoElement.style.display = 'block';
                    // Adjust header padding if logo is shown
                    document.querySelector('.header h1').style.paddingTop = '0';
                }
                
                // Show agent contact info if provided
                if (agentName || agentEmail || agentPhone) {
                    const agentInfoDiv = document.getElementById('agentInfo');
                    agentInfoDiv.style.display = 'block';
                    
                    if (agentName) {
                        document.getElementById('agentName').textContent = decodeURIComponent(agentName);
                        document.getElementById('hiddenAgentName').value = decodeURIComponent(agentName);
                    }
                    
                    if (agentEmail) {
                        document.getElementById('agentEmail').textContent = '✉️ ' + decodeURIComponent(agentEmail);
                        document.getElementById('hiddenAgentEmail').value = decodeURIComponent(agentEmail);
                    }
                    
                    if (agentPhone) {
                        document.getElementById('agentPhone').textContent = '📞 ' + decodeURIComponent(agentPhone);
                        document.getElementById('hiddenAgentPhone').value = decodeURIComponent(agentPhone);
                    }
                }
                
                // Update footer with agency information
                document.getElementById('footerAgencyName').textContent = decodeURIComponent(agencyName);
                
                let footerContact = '';
                if (agencyEmail) {
                    footerContact += decodeURIComponent(agencyEmail);
                    document.getElementById('hiddenAgencyEmail').value = decodeURIComponent(agencyEmail);
                }
                if (agencyPhone) {
                    if (footerContact) footerContact += ' | ';
                    footerContact += decodeURIComponent(agencyPhone);
                    document.getElementById('hiddenAgencyPhone').value = decodeURIComponent(agencyPhone);
                }
                if (footerContact) {
                    document.getElementById('footerAgencyContact').textContent = footerContact;
                }
            } else {
                // No agency specified - show generic branding
                document.getElementById('agencyName').textContent = 'Statement of No Loss';
                document.getElementById('footerAgencyName').textContent = 'NoLossForm.com';
                document.getElementById('footerAgencyContact').textContent = 'Automated Insurance Documentation System';
                
                // Store as direct submission
                document.getElementById('hiddenAgencyName').value = 'Direct Submission';
            }
            
            // Pre-fill customer form fields from URL parameters
            const customerFields = [
                'insuredName', 'policyNumber', 'propertyAddress', 
                'city', 'state', 'zipCode', 'email', 'phone',
                'lapseStartDate', 'lapseEndDate'
            ];
            
            customerFields.forEach(field => {
                const value = urlParams.get(field);
                if (value) {
                    const element = document.getElementById(field);
                    if (element) {
                        element.value = decodeURIComponent(value);
                    }
                }
            });
            
            // Set today's date for signature date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('signatureDate').value = today;
            
            // Initialize signature pad
            initSignaturePad();
        });
        
        // Language toggle function
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update all translatable elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update agent contact title based on language
            if (currentLanguage === 'es') {
                document.getElementById('agentContactTitle').innerHTML = '<strong>Su Agente:</strong>';
            } else {
                document.getElementById('agentContactTitle').innerHTML = '<strong>Your Agent:</strong>';
            }
        }
        
        // Initialize signature pad
        function initSignaturePad() {
            const canvas = document.getElementById('signatureCanvas');
            const container = document.getElementById('signaturePad');
            
            // Set canvas size
            canvas.width = container.offsetWidth - 4;
            canvas.height = 200;
            
            const ctx = canvas.getContext('2d');
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                lastX = x;
                lastY = y;
            }
            
            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                lastX = x;
                lastY = y;
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            signaturePad = { canvas, ctx };
        }
        
        // Clear signature
        function clearSignature() {
            if (signaturePad) {
                signaturePad.ctx.clearRect(0, 0, signaturePad.canvas.width, signaturePad.canvas.height);
            }
        }
        
        // Check if signature is empty
        function isSignatureEmpty() {
            if (!signaturePad) return true;
            const imageData = signaturePad.ctx.getImageData(0, 0, signaturePad.canvas.width, signaturePad.canvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                if (data[i + 3] !== 0) return false;
            }
            return true;
        }
        
        // Handle form submission
        document.getElementById('noLossForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate signature
            if (isSignatureEmpty()) {
                showMessage('Please provide your signature before submitting.', 'error');
                return;
            }
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Add signature as base64
            data.signature = signaturePad.canvas.toDataURL();
            data.submittedAt = new Date().toISOString();
            data.language = currentLanguage;
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            
            submitBtn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'block';
            
            try {
                // Submit to Google Apps Script
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // Generate confirmation number (since no-cors doesn't return data)
                const confirmationNumber = 'SNL-' + Date.now().toString().slice(-8);
                
                // Show success modal
                document.getElementById('confirmationNumber').textContent = confirmationNumber;
                document.getElementById('successModal').style.display = 'block';
                
                // Reset form
                this.reset();
                clearSignature();
                
                // Set today's date again
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('signatureDate').value = today;
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('Failed to submit form. Please try again or contact your agent.', 'error');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
            }
        });
        
        // Show message function
        function showMessage(text, type) {
            const messageEl = type === 'success' 
                ? document.getElementById('successMessage')
                : document.getElementById('errorMessage');
            
            messageEl.textContent = text;
            messageEl.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }
        
        // Phone number formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = `(${value}`;
                } else if (value.length <= 6) {
                    value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
                } else {
                    value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
                }
            }
            e.target.value = value;
        });
        
        // ZIP code validation
        document.getElementById('zipCode').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 5);
        });
    </script>
</body>
</html>
